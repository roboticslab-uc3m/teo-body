<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>yarp-devices: Cui Absolute Firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">yarp-devices
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cui Absolute Firmware </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md18"></a>
Necessary requirements</h1>
<p>First, we need to install the MPLAB tool v.8.92. If we already have windows installed on our computer, we can install it by directly downloading the application in <a href="https://drive.google.com/open?id=1n51XC7JwGAtncWq1itDxE7FpyqdSyaWD">this</a> link. In case of working with Ubuntu or another S.O, you can download VirtualBox and load the virtual machine contained in the following <a href="https://drive.google.com/open?id=0BxR76I90oKSmQ0xsS0loZVhhRnM">link</a>. This virtual machine contains all the necessary tools installed on Windows 7: <b>MPLAM IDE v.8.92</b> and <b>EasySetup</b>.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
How to download the firmware on the PIC</h1>
<p>Once MPLAB is opened, we load the project by selecting <em>Project &gt; Open</em> and select the file <code>pic_source.mcp</code> This will open the work environment, where <code>main.c</code> is the code file that will be compiled in our PIC. Make sure that the MPLAB is already connected to the PIC. We need external power connected to the programmer. It's recommended to disconnect the CAN wire that is connected to the driver so as not to derive electric current to it.</p>
<p>First, we must modify <a href="./Pic_source/main.c#L69">line 69</a>, corresponding to the ID of that encoder. We can see the correspondence in the <a href="http://robots.uc3m.es/gitbook-teo-developer-manual/diagrams.html#joint-indexes">diagram</a> and adding 100 to the ID of the joint. Example: for the elbow of the left arm joint ID 24 we should write <a href="./Pic_source/main.c#L69">ID 124</a>. Then we need to follow the next steps:</p><ul>
<li>We compile: <code>Project&gt; Build All</code></li>
<li>Select the programmer: <code>Programmer&gt; Select Programmer&gt; MPLAB ICD 2</code></li>
<li>Connect the programmer to the PIC: <code>Programmer&gt; Connect</code></li>
<li>Program: <code>Porgrammer&gt; Program</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md20"></a>
Set the CUI to zero</h1>
<p>In this case we'll use the PCAN-View program. To install PCAN-View via repository you need to:</p>
<p>Download and install the following file peak-system.list from the PEAK-System website: </p><div class="fragment"><div class="line">$ wget -q http://www.peak-system.com/debian/dists/`lsb_release -cs`/peak-system.list -O- | sudo tee /etc/apt/sources.list.d/peak-system.list</div>
</div><!-- fragment --><p>Note: If the lsb_release tool is not installed on your Linux system then replace <code>lsb_release -cs</code> by the name of your Linux distribution. For example: </p><div class="fragment"><div class="line">$ wget -q http://www.peak-system.com/debian/dists/wheezy/peak-system.list -O- | sudo tee /etc/apt/sources.list.d/peak-system.list</div>
</div><!-- fragment --><p>Then, download and install the PEAK-System public key for apt-secure, so that the repository is trusted: </p><div class="fragment"><div class="line">$ wget -q http://www.peak-system.com/debian/peak-system-public-key.asc -O- | sudo apt-key add -</div>
</div><!-- fragment --><p>To install pcanview-ncurses next, do: </p><div class="fragment"><div class="line">$ sudo apt-get update</div>
<div class="line">$ sudo apt-get install pcanview-ncurses</div>
</div><!-- fragment --><p>Run <code>pcanview</code> in a new terminal. The first window you can see is the <code>Connect</code> window. You need to choose the CAN channel in which the CUI is connected. Below it's important to set the <code>Bitrate to 1Mbps (1000000 bps)</code>. Then the reception and transmission window will be opened. In the transmission window we can see the last messages saved to send. If the message hasn't been created before, we must create it by selecting <code>Transmit&gt; New Message</code>. We can set the encoder ID in decimal format by selecting <code>File&gt; Settings&gt; CAN ID Format&gt; Decimal</code>. Once the message window is opened with <code>New Message</code> or <code>Edit Message</code> you need to write or modify the ID to send the message by double clicking on the message or by pressing Enter on it. Fields <code>Len: 1</code> and <code>Data: ff</code>. The rest of the fields <b>must be unchecked</b> except <code>Paused</code>. That is important because <code>CAN FD</code> is checked by default when you create a new message and this can produce communication errors. Then you can press <code>Ok</code>. To confirm that it has been done correctly, we must receive a message in the Rx window with ID = OP (0x200) + canID. It will be an ACK message.</p>
<p>Another way to read the value of the CUI will be by sending a pull message with <code>Data: 03</code> and the same ID. We should get a message with <b>zeros</b> in the Data field of the received message and ID = OP(0x180) + canID. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jun 24 2021 17:20:54 for yarp-devices by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
